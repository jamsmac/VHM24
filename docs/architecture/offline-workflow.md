# –û—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ (Offline Workflow)

## –ü—Ä–æ–±–ª–µ–º–∞

–û–ø–µ—Ä–∞—Ç–æ—Ä—ã —á–∞—Å—Ç–æ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –º–µ—Å—Ç–∞—Ö –±–µ–∑ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:
- –ü–æ–¥–≤–∞–ª—ã
- –ü–∞—Ä–∫–∏–Ω–≥–∏
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–æ–º–µ—â–µ–Ω–∏—è
- –ó–æ–Ω—ã —Å–æ —Å–ª–∞–±—ã–º —Å–∏–≥–Ω–∞–ª–æ–º

–ü—Ä–µ–∂–Ω—è—è –º–æ–¥–µ–ª—å **—Ç—Ä–µ–±–æ–≤–∞–ª–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ** –î–û –∏ –ü–û–°–õ–ï –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏, —á—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–æ —Ä–∞–±–æ—Ç—É –≤ –æ—Ñ–ª–∞–π–Ω.

## –†–µ—à–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º** —Å –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–æ—Ç–æ –∏ –≤–≤–æ–¥ **–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö**.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

1. ‚úÖ **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –±–µ–∑ —Ñ–æ—Ç–æ** - –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ñ–æ—Ç–æ
2. ‚úÖ **–û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** - —Ñ–æ—Ç–æ –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–∑–∂–µ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å–≤—è–∑–∏
3. ‚úÖ **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è** - —Å–∏—Å—Ç–µ–º–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç –æ –Ω–µ–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ
4. ‚úÖ **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ** - –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –¥–∞—Ç—É —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
5. ‚úÖ **–ê—É–¥–∏—Ç** - –≤—Å–µ –æ—Ñ–ª–∞–π–Ω-–æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ Task

```typescript
// –î–∞—Ç–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç created_at)
operation_date: Date | null;

// –ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –Ω–æ —Ñ–æ—Ç–æ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
pending_photos: boolean;

// –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –≤ –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ
offline_completed: boolean;
```

### –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ InventoryMovement

```typescript
// –î–∞—Ç–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ (–º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç created_at)
operation_date: Date | null;
```

**–í–∞–∂–Ω–æ**:
- `created_at` / `completed_at` - –∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ **–≤–Ω–µ—Å–µ–Ω—ã –≤ —Å–∏—Å—Ç–µ–º—É**
- `operation_date` - –∫–æ–≥–¥–∞ –æ–ø–µ—Ä–∞—Ü–∏—è **—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞**

## API Usage

### 1. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤ –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ

```typescript
POST /tasks/:id/complete
{
  "skip_photos": true,  // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ñ–æ—Ç–æ
  "operation_date": "2025-11-15T14:30:00Z",  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–∞—Ç–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
  "items": [
    {
      "nomenclature_id": "uuid",
      "actual_quantity": 48
    }
  ],
  "completion_notes": "–í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ –ø–æ–¥–≤–∞–ª–µ –±–µ–∑ —Å–≤—è–∑–∏"
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (status = COMPLETED)
- ‚è≥ `pending_photos = true` - –æ–∂–∏–¥–∞—é—Ç—Å—è —Ñ–æ—Ç–æ
- üîí `offline_completed = true` - –æ—Ç–º–µ—Ç–∫–∞ –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞
- üìÖ `operation_date` - –¥–∞—Ç–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- üìã Inventory –æ–±–Ω–æ–≤–ª–µ–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∞—Ç–æ–π

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á —Å –Ω–µ–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ —Ñ–æ—Ç–æ

```typescript
GET /tasks/pending-photos

Response:
[
  {
    "id": "uuid",
    "type_code": "refill",
    "machine": { "machine_number": "M-001", "location": { "name": "–¢–¶ –°–µ—Ä–≥–µ–ª–∏" } },
    "operation_date": "2025-11-15T14:30:00Z",
    "completed_at": "2025-11-15T18:45:00Z", // –ö–æ–≥–¥–∞ –≤–Ω–µ—Å–µ–Ω–æ –≤ —Å–∏—Å—Ç–µ–º—É
    "pending_photos": true,
    "offline_completed": true
  }
]
```

**–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**:
- –û–ø–µ—Ä–∞—Ç–æ—Ä—ã –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏
- –ê–¥–º–∏–Ω—ã –≤–∏–¥—è—Ç –≤—Å–µ –∑–∞–¥–∞—á–∏

### 3. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –¥–ª—è –æ—Ñ–ª–∞–π–Ω-–∑–∞–¥–∞—á–∏

**–®–∞–≥ 1**: –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ Files API

```typescript
POST /files
FormData:
  - file: photo_before.jpg
  - category: task_photo_before
  - entity_id: task_uuid
  - entity_type: task

POST /files
FormData:
  - file: photo_after.jpg
  - category: task_photo_after
  - entity_id: task_uuid
  - entity_type: task
```

**–®–∞–≥ 2**: –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏

```typescript
POST /tasks/:id/upload-photos

Response:
{
  "id": "uuid",
  "pending_photos": false,  // ‚úÖ –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
  "has_photo_before": true,
  "has_photo_after": true
}
```

## Workflow –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–µ–∂–∏–º (–æ–Ω–ª–∞–π–Ω)

```
1. –û–ø–µ—Ä–∞—Ç–æ—Ä —É –∞–ø–ø–∞—Ä–∞—Ç–∞
2. Telegram –±–æ—Ç: "–°–¥–µ–ª–∞–π —Ñ–æ—Ç–æ –î–û" ‚Üí üì∏ –ó–∞–≥—Ä—É–∂–∞–µ—Ç
3. –í—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞–±–æ—Ç—É
4. Telegram –±–æ—Ç: "–°–¥–µ–ª–∞–π —Ñ–æ—Ç–æ –ü–û–°–õ–ï" ‚Üí üì∏ –ó–∞–≥—Ä—É–∂–∞–µ—Ç
5. –ó–∞–≤–µ—Ä—à–∞–µ—Ç –∑–∞–¥–∞—á—É ‚Üí ‚úÖ –ì–æ—Ç–æ–≤–æ
```

### –û—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º (–Ω–æ–≤—ã–π)

```
1. –û–ø–µ—Ä–∞—Ç–æ—Ä —É –∞–ø–ø–∞—Ä–∞—Ç–∞ (–Ω–µ—Ç —Å–≤—è–∑–∏ ‚ùå)
2. Telegram –±–æ—Ç: "–°–¥–µ–ª–∞–π —Ñ–æ—Ç–æ –î–û" ‚Üí [–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å–µ–π—á–∞—Å]
3. –í—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞–±–æ—Ç—É
4. –í–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω–æ
5. –ó–∞–≤–µ—Ä—à–∞–µ—Ç –∑–∞–¥–∞—á—É —Å skip_photos=true ‚Üí ‚è≥ –û–∂–∏–¥–∞—é—Ç—Å—è —Ñ–æ—Ç–æ
6. –ü–æ–∑–∂–µ (–µ—Å—Ç—å —Å–≤—è–∑—å ‚úÖ):
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   - –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å
```

## –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

### –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É

Telegram –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω–æ:
```
‚ö†Ô∏è –£ –≤–∞—Å 3 –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á–∏ –±–µ–∑ —Ñ–æ—Ç–æ:

1. –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ M-001 (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ 15.11 14:30)
2. –ò–Ω–∫–∞—Å—Å–∞—Ü–∏—è M-005 (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ 14.11 16:45)
3. –†–µ–º–æ–Ω—Ç M-012 (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ 13.11 10:20)

–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```

### –≠—Å–∫–∞–ª–∞—Ü–∏—è (—á–µ—Ä–µ–∑ 3 –¥–Ω—è)

```
üî¥ –í–ê–ñ–ù–û: –ó–∞–¥–∞—á–∞ TSK-12345 –æ–∂–∏–¥–∞–µ—Ç —Ñ–æ—Ç–æ —É–∂–µ 3 –¥–Ω—è!

–ê–ø–ø–∞—Ä–∞—Ç: M-001 (–¢–¶ –°–µ—Ä–≥–µ–ª–∏)
–î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 12.11.2025 14:30

[–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ —Å–µ–π—á–∞—Å]
```

## –í–≤–æ–¥ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–∏–º–µ—Ä: –∏–º–ø–æ—Ä—Ç —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –≤–≤–µ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–¥–Ω–∏–º —á–∏—Å–ª–æ–º:

```typescript
// –ò–º–ø–æ—Ä—Ç –ø—Ä–æ–¥–∞–∂ –∑–∞ –ø—Ä–æ—à–ª—É—é –Ω–µ–¥–µ–ª—é
POST /sales-import/upload
{
  ...
  "rows": [
    {
      "date": "2025-11-08",  // –î–∞—Ç–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–¥–∞–∂–∏
      "machine_number": "M-001",
      "amount": 15000,
      "product_name": "–ö–æ—Ñ–µ –∫–∞–ø—É—á–∏–Ω–æ",
      "quantity": 30
    }
  ]
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- Transaction —Å–æ–∑–¥–∞–Ω–∞ —Å `sale_date = 2025-11-08`
- InventoryMovement —Å–æ–∑–¥–∞–Ω —Å `operation_date = 2025-11-08`
- `created_at = NOW()` (–∫–æ–≥–¥–∞ –≤–Ω–µ—Å–µ–Ω–æ –≤ —Å–∏—Å—Ç–µ–º—É)

### –ü—Ä–∏–º–µ—Ä: –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –≤—á–µ—Ä–∞, –≤–Ω–µ—Å–µ–Ω–∞ —Å–µ–≥–æ–¥–Ω—è

```typescript
POST /tasks/:id/complete
{
  "operation_date": "2025-11-14T16:00:00Z",  // –í—á–µ—Ä–∞ –≤ 16:00
  "skip_photos": true,
  ...
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- `operation_date = 2025-11-14 16:00` (–∫–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ)
- `completed_at = NOW()` (–∫–æ–≥–¥–∞ –≤–Ω–µ—Å–µ–Ω–æ)
- InventoryMovement –∏–º–µ–µ—Ç `operation_date = 2025-11-14 16:00`

## –ê—É–¥–∏—Ç –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É–¥–∏—Ç-–ª–æ–≥ –¥–ª—è –æ—Ñ–ª–∞–π–Ω-–æ–ø–µ—Ä–∞—Ü–∏–π

```typescript
{
  "action": "UPDATE",
  "entity_type": "TASK",
  "entity_id": "task-uuid",
  "entity_name": "–ó–∞–¥–∞—á–∞ refill (–æ—Ñ–ª–∞–π–Ω)",
  "description": "–ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –≤ –û–§–õ–ê–ô–ù-–†–ï–ñ–ò–ú–ï –±–µ–∑ —Ñ–æ—Ç–æ. –§–æ—Ç–æ –æ–∂–∏–¥–∞—é—Ç—Å—è. –î–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: 2025-11-15T14:30:00Z",
  "metadata": {
    "task_id": "uuid",
    "machine_id": "uuid",
    "offline_completed": true,
    "pending_photos": true,
    "operation_date": "2025-11-15T14:30:00Z",
    "completed_at": "2025-11-15T18:45:00Z"
  }
}
```

### –ê—É–¥–∏—Ç-–ª–æ–≥ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ

```typescript
{
  "action": "UPDATE",
  "entity_type": "TASK",
  "entity_id": "task-uuid",
  "entity_name": "–ó–∞–¥–∞—á–∞ refill - —Ñ–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã",
  "description": "–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–ª—è –∑–∞–¥–∞—á–∏, –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π –≤ –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ. –î–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: 2025-11-15T14:30:00Z",
  "metadata": {
    "task_id": "uuid",
    "machine_id": "uuid",
    "operation_date": "2025-11-15T14:30:00Z",
    "uploaded_at": "2025-11-15T19:00:00Z"
  }
}
```

### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö

```
WARN: –ó–∞–¥–∞—á–∞ abc-123 –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –≤ –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ –±–µ–∑ —Ñ–æ—Ç–æ. –û–ø–µ—Ä–∞—Ç–æ—Ä: user-uuid
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ú–∏–≥—Ä–∞—Ü–∏—è: 1731670000001-AddOfflineModeSupport

–î–æ–±–∞–≤–ª—è–µ—Ç:
- `tasks.operation_date` - timestamp with time zone
- `tasks.pending_photos` - boolean (default: false)
- `tasks.offline_completed` - boolean (default: false)
- `inventory_movements.operation_date` - timestamp with time zone
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

```sql
-- –ù–∞–π—Ç–∏ –≤—Å–µ –∑–∞–¥–∞—á–∏ —Å –Ω–µ–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ —Ñ–æ—Ç–æ
SELECT * FROM tasks
WHERE pending_photos = true
AND status = 'completed'
ORDER BY operation_date DESC;

-- –ù–∞–π—Ç–∏ –¥–≤–∏–∂–µ–Ω–∏—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É –æ–ø–µ—Ä–∞—Ü–∏–∏
SELECT * FROM inventory_movements
WHERE operation_date BETWEEN '2025-11-15' AND '2025-11-16'
ORDER BY operation_date DESC;
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### –î–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
- ‚úÖ –ú–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ —Å–≤—è–∑–∏
- ‚úÖ –ù–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ
- ‚úÖ –§–æ—Ç–æ –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–∑–∂–µ –≤ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è
- ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –≤ —Å–ª–æ–∂–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö

### –î–ª—è –±–∏–∑–Ω–µ—Å–∞
- ‚úÖ –î–∞–Ω–Ω—ã–µ –≤–Ω–æ—Å—è—Ç—Å—è —Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ (–Ω–µ –∂–¥—É—Ç —Å–≤—è–∑–∏)
- ‚úÖ –û—Å—Ç–∞—Ç–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Å—Ä–∞–∑—É
- ‚úÖ –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ–∑–∂–µ (–∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–µ —Ç–µ—Ä—è–µ—Ç—Å—è)
- ‚úÖ –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –æ—Ñ–ª–∞–π–Ω-–æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –í–≤–æ–¥ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏

### –î–ª—è —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞—Ç: –∫–æ–≥–¥–∞ —Å–¥–µ–ª–∞–Ω–æ vs –∫–æ–≥–¥–∞ –∑–∞–ø–∏—Å–∞–Ω–æ
- ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å –≤ —Ä–∞–±–æ—Ç–µ —Å –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–º–ø–æ—Ä—Ç–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π –∞—É–¥–∏—Ç

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–ß–µ–∫-–ª–∏—Å—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏** - –¥–∞–∂–µ –≤ –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ –Ω—É–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –ø—É–Ω–∫—Ç—ã
2. **–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã** - –¥–ª—è –∑–∞–¥–∞—á –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
3. **–§–æ—Ç–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é—Ç—Å—è** - —Å–∏—Å—Ç–µ–º–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏—Ö
4. **operation_date –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞** - –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Frontend: –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤ –æ—Ñ–ª–∞–π–Ω

```typescript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–≤—è–∑–∏
const isOffline = !navigator.onLine;

const completeTask = async (taskId: string) => {
  const dto: CompleteTaskDto = {
    skip_photos: isOffline, // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ –æ—Ñ–ª–∞–π–Ω
    operation_date: new Date().toISOString(), // –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
    items: [...],
    completion_notes: isOffline
      ? "–í—ã–ø–æ–ª–Ω–µ–Ω–æ –±–µ–∑ —Å–≤—è–∑–∏, —Ñ–æ—Ç–æ –∑–∞–≥—Ä—É–∂—É –ø–æ–∑–∂–µ"
      : "–í—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ"
  };

  await tasksApi.complete(taskId, dto);

  if (isOffline) {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
    savePendingPhotoTask(taskId);
  }
};
```

### Frontend: –∑–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ

```typescript
const uploadPendingPhotos = async (taskId: string) => {
  // 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ Files API
  await filesApi.upload({
    file: photoBefore,
    category: 'task_photo_before',
    entity_id: taskId,
    entity_type: 'task'
  });

  await filesApi.upload({
    file: photoAfter,
    category: 'task_photo_after',
    entity_id: taskId,
    entity_type: 'task'
  });

  // 2. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏
  await tasksApi.uploadPendingPhotos(taskId);

  // 3. –£–¥–∞–ª–∏—Ç—å –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
  removePendingPhotoTask(taskId);
};
```

### Telegram Bot: –æ—Ñ–ª–∞–π–Ω workflow

```typescript
// –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏
bot.action('complete_task', async (ctx) => {
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–ø—Ü–∏—é –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ñ–æ—Ç–æ
  await ctx.reply(
    'üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –ü–û–°–õ–ï?',
    {
      reply_markup: {
        inline_keyboard: [
          [{ text: 'üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ–π—á–∞—Å', callback_data: 'upload_photo' }],
          [{ text: '‚è≠ –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å (–∑–∞–≥—Ä—É–∂—É –ø–æ–∑–∂–µ)', callback_data: 'skip_photo' }]
        ]
      }
    }
  );
});

// –ï—Å–ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏–ª
bot.action('skip_photo', async (ctx) => {
  await completeTaskOffline(taskId, {
    skip_photos: true,
    operation_date: new Date().toISOString()
  });

  await ctx.reply(
    '‚úÖ –ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\n' +
    '‚ö†Ô∏è –ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –ø–æ–∑–∂–µ\n' +
    '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /pending_photos –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞'
  );
});

// –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö
bot.command('pending_photos', async (ctx) => {
  const tasks = await getPendingPhotosTasks(ctx.user.id);

  if (tasks.length === 0) {
    await ctx.reply('‚úÖ –í—Å–µ –∑–∞–¥–∞—á–∏ —Å —Ñ–æ—Ç–æ!');
    return;
  }

  let message = `‚è≥ –ó–∞–¥–∞—á–∏ –±–µ–∑ —Ñ–æ—Ç–æ (${tasks.length}):\n\n`;
  for (const task of tasks) {
    message += `üìã ${task.type_code} - ${task.machine.machine_number}\n`;
    message += `üìÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${formatDate(task.operation_date)}\n\n`;
  }

  await ctx.reply(message, {
    reply_markup: {
      inline_keyboard: tasks.map(t => [
        { text: `üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–ª—è ${t.machine.machine_number}`, callback_data: `upload_${t.id}` }
      ])
    }
  });
});
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–û—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º –¥–µ–ª–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É **–≥–∏–±–∫–æ–π –∏ –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ–π** –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö —Ä–∞–±–æ—Ç—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤.

–ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:
- ‚úÖ –†–∞–±–æ—Ç–∞ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å –Ω–µ —Ç–µ—Ä—è–µ—Ç—Å—è (—Ñ–æ—Ç–æ –ø–æ–∑–∂–µ)
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –¥–ª—è –±–∏–∑–Ω–µ—Å–∞

**–§–∏–ª–æ—Å–æ—Ñ–∏—è**: –î–∞–Ω–Ω—ã–µ –≤–∞–∂–Ω–µ–µ —Ñ–æ—Ç–æ. –§–æ—Ç–æ - –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ, –Ω–æ –Ω–µ –±–ª–æ–∫–µ—Ä.
