# SPRINT 3 - PHASE 1 COMPLETED ‚úÖ

**–î–∞—Ç–∞**: 2025-11-20
**–§–∞–∑–∞**: –î–æ—Ä–∞–±–æ—Ç–∫–∞ —Å—Ö–µ–º—ã –ë–î (–º–∏–≥—Ä–∞—Ü–∏–∏)
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

---

## üìã –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ó–ê–î–ê–ß–ò

### 1. ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ TaskType enum (REQ-TASK-01)

**–§–∞–π–ª**: `backend/src/modules/tasks/entities/task.entity.ts`

**–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –∑–∞–¥–∞—á**:
- `INSPECTION` - –û—Å–º–æ—Ç—Ä
- `REPLACE_HOPPER` - –ó–∞–º–µ–Ω–∞ –±—É–Ω–∫–µ—Ä–∞
- `REPLACE_GRINDER` - –ó–∞–º–µ–Ω–∞ –≥—Ä–∏–Ω–¥–µ—Ä–∞
- `REPLACE_BREW_UNIT` - –ó–∞–º–µ–Ω–∞ –≤–∞—Ä–æ—á–Ω–æ–≥–æ –±–ª–æ–∫–∞
- `REPLACE_MIXER` - –ó–∞–º–µ–Ω–∞ –º–∏–∫—Å–µ—Ä–∞

**–¢–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è**:
```typescript
export enum TaskType {
  REFILL = 'refill',                      // –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ ‚úÖ
  COLLECTION = 'collection',               // –ò–Ω–∫–∞—Å—Å–∞—Ü–∏—è ‚úÖ
  CLEANING = 'cleaning',                   // –ú–æ–π–∫–∞ ‚úÖ
  REPAIR = 'repair',                       // –†–µ–º–æ–Ω—Ç ‚úÖ
  INSTALL = 'install',                     // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ‚úÖ
  REMOVAL = 'removal',                     // –°–Ω—è—Ç–∏–µ ‚úÖ
  AUDIT = 'audit',                         // –†–µ–≤–∏–∑–∏—è ‚úÖ
  INSPECTION = 'inspection',               // –û—Å–º–æ—Ç—Ä ‚úÖ NEW
  REPLACE_HOPPER = 'replace_hopper',       // –ó–∞–º–µ–Ω–∞ –±—É–Ω–∫–µ—Ä–∞ ‚úÖ NEW
  REPLACE_GRINDER = 'replace_grinder',     // –ó–∞–º–µ–Ω–∞ –≥—Ä–∏–Ω–¥–µ—Ä–∞ ‚úÖ NEW
  REPLACE_BREW_UNIT = 'replace_brew_unit', // –ó–∞–º–µ–Ω–∞ –≤–∞—Ä–æ—á–Ω–æ–≥–æ –±–ª–æ–∫–∞ ‚úÖ NEW
  REPLACE_MIXER = 'replace_mixer',         // –ó–∞–º–µ–Ω–∞ –º–∏–∫—Å–µ—Ä–∞ ‚úÖ NEW
}
```

---

### 2. ‚úÖ –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è EquipmentComponent –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è (REQ-ASSET-10)

**–§–∞–π–ª**: `backend/src/modules/equipment/entities/equipment-component.entity.ts`

**–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π enum**:
```typescript
export enum ComponentLocationType {
  MACHINE = 'machine',       // –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –º–∞—à–∏–Ω–µ
  WAREHOUSE = 'warehouse',   // –ù–∞ —Å–∫–ª–∞–¥–µ
  WASHING = 'washing',       // –ù–∞ –º–æ–π–∫–µ
  DRYING = 'drying',        // –ù–∞ —Å—É—à–∫–µ
  REPAIR = 'repair',        // –í —Ä–µ–º–æ–Ω—Ç–µ
}
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ entity**:
- ‚úÖ `machine_id` —Ç–µ–ø–µ—Ä—å **nullable** (–º–æ–∂–µ—Ç –±—ã—Ç—å `null`, –µ—Å–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–∞ —Å–∫–ª–∞–¥–µ/–º–æ–π–∫–µ/—Ä–µ–º–æ–Ω—Ç–µ)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `current_location_type: ComponentLocationType` (enum)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `current_location_ref: string | null` (—Å—Å—ã–ª–∫–∞ –Ω–∞ –ª–æ–∫–∞—Ü–∏—é)
- ‚úÖ FK –Ω–∞ `machines` –∏–∑–º–µ–Ω—ë–Ω —Å `CASCADE` –Ω–∞ `SET NULL`

**–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å**, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –º–∞—à–∏–Ω—ã.

---

### 3. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã component_movements (REQ-ASSET-11)

**–§–∞–π–ª**: `backend/src/modules/equipment/entities/component-movement.entity.ts`

**–ù–æ–≤–∞—è entity –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**:

```typescript
export enum MovementType {
  INSTALL = 'install',                       // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –º–∞—à–∏–Ω—É
  REMOVE = 'remove',                         // –°–Ω—è—Ç–∏–µ —Å –º–∞—à–∏–Ω—ã
  SEND_TO_WASH = 'send_to_wash',            // –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ –º–æ–π–∫—É
  RETURN_FROM_WASH = 'return_from_wash',    // –í–æ–∑–≤—Ä–∞—Ç —Å –º–æ–π–∫–∏
  SEND_TO_DRYING = 'send_to_drying',        // –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å—É—à–∫—É
  RETURN_FROM_DRYING = 'return_from_drying', // –í–æ–∑–≤—Ä–∞—Ç —Å —Å—É—à–∫–∏
  MOVE_TO_WAREHOUSE = 'move_to_warehouse',  // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞ —Å–∫–ª–∞–¥
  MOVE_TO_MACHINE = 'move_to_machine',      // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∫ –º–∞—à–∏–Ω–µ
  SEND_TO_REPAIR = 'send_to_repair',        // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ —Ä–µ–º–æ–Ω—Ç
  RETURN_FROM_REPAIR = 'return_from_repair', // –í–æ–∑–≤—Ä–∞—Ç –∏–∑ —Ä–µ–º–æ–Ω—Ç–∞
}
```

**–ü–æ–ª—è**:
- `component_id` - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- `from_location_type` / `from_location_ref` - –æ—Ç–∫—É–¥–∞
- `to_location_type` / `to_location_ref` - –∫—É–¥–∞
- `movement_type` - —Ç–∏–ø –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
- `related_machine_id` - —Å–≤—è–∑–∞–Ω–Ω–∞—è –º–∞—à–∏–Ω–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- `task_id` - —Å–≤—è–∑–∞–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ (–µ—Å–ª–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ —Ä–∞–º–∫–∞—Ö –∑–∞–¥–∞—á–∏)
- `performed_by_user_id` - –∫—Ç–æ –≤—ã–ø–æ–ª–Ω–∏–ª
- `moved_at` - –∫–æ–≥–¥–∞
- `comment` - –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

**–ú–∏–≥—Ä–∞—Ü–∏—è**: `1732300000001-CreateComponentMovementsTable.ts`

---

### 4. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã hopper_types (REQ-ASSET-BH-01)

**–§–∞–π–ª**: `backend/src/modules/equipment/entities/hopper-type.entity.ts`

**–ù–æ–≤–∞—è entity –¥–ª—è —Ç–∏–ø–æ–≤ –±—É–Ω–∫–µ—Ä–æ–≤ (–∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤)**:

**–ü–æ–ª—è**:
- `code` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ (milk_powder, sugar, tea_fruit, etc.)
- `name` - –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- `name_en` - –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
- `description` - –æ–ø–∏—Å–∞–Ω–∏–µ
- `category` - –∫–∞—Ç–µ–≥–æ—Ä–∏—è (dairy, tea, coffee, etc.)
- `requires_refrigeration` - —Ç—Ä–µ–±—É–µ—Ç –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è
- `shelf_life_days` - —Å—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏
- `typical_capacity_kg` - —Ç–∏–ø–∏—á–Ω–∞—è –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –±—É–Ω–∫–µ—Ä–∞
- `unit_of_measure` - –µ–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è

**–ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (10 —Ç–∏–ø–æ–≤)**:
1. –°—É—Ö–æ–µ –º–æ–ª–æ–∫–æ (Milk Powder)
2. –°–∞—Ö–∞—Ä (Sugar)
3. –ß–∞–π —Ñ—Ä—É–∫—Ç–æ–≤—ã–π (Fruit Tea)
4. –ß–∞–π –ª–∏–º–æ–Ω–Ω—ã–π (Lemon Tea)
5. –ì–æ—Ä—è—á–∏–π —à–æ–∫–æ–ª–∞–¥ (Hot Chocolate)
6. –†–∞—Å—Ç–≤–æ—Ä–∏–º—ã–π –∫–æ—Ñ–µ (Instant Coffee)
7. –°–ª–∏–≤–∫–∏ (Creamer)
8. –°–º–µ—Å—å –ö–∞–ø—É—á–∏–Ω–æ (Cappuccino Mix)
9. –ö–∞–∫–∞–æ (Cocoa)
10. –ú–æ–ª–æ—á–Ω—ã–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç (Milk Substitute)

**–ú–∏–≥—Ä–∞—Ü–∏—è**: `1732300000002-CreateHopperTypesTable.ts`

---

### 5. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã task_components (REQ-TASK-21)

**–§–∞–π–ª**: `backend/src/modules/tasks/entities/task-component.entity.ts`

**–ù–æ–≤–∞—è entity –¥–ª—è —Å–≤—è–∑–∏ –∑–∞–¥–∞—á —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏**:

```typescript
export enum ComponentRole {
  OLD = 'old',       // –°—Ç–∞—Ä—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (–∫–æ—Ç–æ—Ä—ã–π —Å–Ω–∏–º–∞–µ—Ç—Å—è)
  NEW = 'new',       // –ù–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (–∫–æ—Ç–æ—Ä—ã–π —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è)
  TARGET = 'target', // –¶–µ–ª–µ–≤–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (–¥–ª—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è/–º–æ–π–∫–∏)
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
- **REPLACE_*** –∑–∞–¥–∞—á–∏: —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è `OLD` (—Å–Ω–∏–º–∞–µ–º—ã–π) –∏ `NEW` (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—ã–π)
- **CLEANING/REPAIR**: —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è `TARGET` (–æ–±—Å–ª—É–∂–∏–≤–∞–µ–º—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)

**–ü–æ–ª—è**:
- `task_id` - –∑–∞–¥–∞—á–∞
- `component_id` - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- `role` - —Ä–æ–ª—å (OLD/NEW/TARGET)
- `notes` - –ø—Ä–∏–º–µ—á–∞–Ω–∏—è
- `metadata` - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ú–∏–≥—Ä–∞—Ü–∏—è**: `1732300000003-CreateTaskComponentsTable.ts`

---

## üìÑ –°–û–ó–î–ê–ù–ù–´–ï –ú–ò–ì–†–ê–¶–ò–ò

1. **1732300000000-ExtendTaskTypesAndComponentLocation.ts**
   - –†–∞—Å—à–∏—Ä—è–µ—Ç `task_type_enum` –Ω–æ–≤—ã–º–∏ —Ç–∏–ø–∞–º–∏ –∑–∞–¥–∞—á
   - –°–æ–∑–¥–∞—ë—Ç `component_location_type_enum`
   - –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É `equipment_components`:
     - –î–µ–ª–∞–µ—Ç `machine_id` nullable
     - –î–æ–±–∞–≤–ª—è–µ—Ç `current_location_type` –∏ `current_location_ref`
   - –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å machine_id –ø–æ–ª—É—á–∞—é—Ç location_type = 'machine')

2. **1732300000001-CreateComponentMovementsTable.ts**
   - –°–æ–∑–¥–∞—ë—Ç `movement_type_enum`
   - –°–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É `component_movements` —Å –ø–æ–ª–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π
   - –°–æ–∑–¥–∞—ë—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã –∏ FK

3. **1732300000002-CreateHopperTypesTable.ts**
   - –°–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É `hopper_types`
   - –ó–∞–ø–æ–ª–Ω—è–µ—Ç –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (10 —Ç–∏–ø–æ–≤ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤)

4. **1732300000003-CreateTaskComponentsTable.ts**
   - –°–æ–∑–¥–∞—ë—Ç `component_role_enum`
   - –°–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É `task_components` –¥–ª—è —Å–≤—è–∑–∏ –∑–∞–¥–∞—á —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
   - –°–æ–∑–¥–∞—ë—Ç –∏–Ω–¥–µ–∫—Å—ã –∏ FK

---

## üîß –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –ú–û–î–£–õ–ò

### Backend Modules:

1. **EquipmentModule** (`backend/src/modules/equipment/equipment.module.ts`)
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `ComponentMovement` entity
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `HopperType` entity

2. **TasksModule** (`backend/src/modules/tasks/tasks.module.ts`)
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `TaskComponent` entity

---

## üìä –ú–ê–ü–ü–ò–ù–ì –¢–†–ï–ë–û–í–ê–ù–ò–ô

### ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û:

- **REQ-ASSET-01**: –†–µ–µ—Å—Ç—Ä –∞–≤—Ç–æ–º–∞—Ç–æ–≤ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ ‚úÖ (—É–∂–µ –±—ã–ª–æ)
- **REQ-ASSET-02**: –£–Ω–∏–∫–∞–ª—å–Ω–∞—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ ‚úÖ (—É–∂–µ –±—ã–ª–æ)
- **REQ-ASSET-10**: –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ ‚úÖ **NEW**
- **REQ-ASSET-11**: –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ ‚úÖ **NEW**
- **REQ-ASSET-BH-01**: –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –±—É–Ω–∫–µ—Ä–æ–≤ (8+ —Ç–∏–ø–æ–≤) ‚úÖ **NEW**
- **REQ-ASSET-BH-02**: –ü—Ä–∏–≤—è–∑–∫–∞ –±—É–Ω–∫–µ—Ä–æ–≤ –∫ –º–∞—à–∏–Ω–∞–º –∏ —Ç–∏–ø–∞–º ‚úÖ **NEW** (–æ—Å–Ω–æ–≤–∞ –≥–æ—Ç–æ–≤–∞)
- **REQ-TASK-01**: –¢–∏–ø—ã –∑–∞–¥–∞—á –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤/—Ç–µ—Ö–Ω–∏–∫–æ–≤ ‚úÖ **–†–ê–°–®–ò–†–ï–ù–û**
- **REQ-TASK-02**: –ü—Ä–∏–≤—è–∑–∫–∞ –∑–∞–¥–∞—á –∫ –º–∞—à–∏–Ω–µ, –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é, —Å—Ä–æ–∫–∞–º ‚úÖ (—É–∂–µ –±—ã–ª–æ)
- **REQ-TASK-03**: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á (–≤—Ä—É—á–Ω—É—é + –∞–≤—Ç–æ) ‚úÖ (—É–∂–µ –±—ã–ª–æ)
- **REQ-TASK-10**: –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ç–æ—Ñ–∏–∫—Å–∞—Ü–∏–∏ ‚úÖ (—É–∂–µ –±—ã–ª–æ)
- **REQ-TASK-11**: –ù–µ–ø–æ–ª–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ñ–æ—Ç–æ ‚úÖ (—É–∂–µ –±—ã–ª–æ)
- **REQ-TASK-12**: –ö–æ–Ω—Ç—Ä–æ–ª—å –ø–æ–ª–Ω–æ—Ç—ã –∑–∞–¥–∞—á –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏ ‚úÖ (—É–∂–µ –±—ã–ª–æ)
- **REQ-TASK-20**: –°–≤—è–∑—å —Å –∑–∞–ø–∞—Å–∞–º–∏ (REFILL) ‚úÖ (—É–∂–µ –±—ã–ª–æ)
- **REQ-TASK-21**: –°–≤—è–∑—å –∑–∞–¥–∞—á —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ ‚úÖ **NEW** (–æ—Å–Ω–æ–≤–∞ –≥–æ—Ç–æ–≤–∞)

---

## üîú –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò (–§–ê–ó–ê 2: Backend API)

–°—Ö–µ–º–∞ –ë–î –≥–æ—Ç–æ–≤–∞. –¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **Backend API** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤—ã–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏:

### 1. ComponentsService & ComponentsController (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)
- [x] CRUD –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —É–∂–µ –µ—Å—Ç—å
- [ ] **–î–æ–±–∞–≤–∏—Ç—å**: API –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π (`POST /components/:id/move`)
- [ ] **–î–æ–±–∞–≤–∏—Ç—å**: API –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏/—Å–Ω—è—Ç–∏—è (`POST /components/:id/install`, `/remove`)
- [ ] **–î–æ–±–∞–≤–∏—Ç—å**: –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π (`GET /components/:id/movements`)

### 2. HopperTypesController
- [ ] –ü—Ä–æ—Å—Ç–æ–π CRUD –¥–ª—è —Ç–∏–ø–æ–≤ –±—É–Ω–∫–µ—Ä–æ–≤
- [ ] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

### 3. TasksService (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á REPLACE_* (—Å–æ–∑–¥–∞–Ω–∏–µ component_movements)
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á–∏ INSPECTION
- [ ] –°–≤—è–∑—å –∑–∞–¥–∞—á —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —á–µ—Ä–µ–∑ TaskComponent
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á

### 4. ComponentMovementsService
- [ ] –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏–π
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è)
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `current_location_*` –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ

---

## üß™ –ö–ê–ö –ó–ê–ü–£–°–¢–ò–¢–¨ –ú–ò–ì–†–ê–¶–ò–ò

```bash
cd backend

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
npm run migration:run

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
npm run migration:show

# –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
npm run migration:revert
```

---

## üìù –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø

1. **–¶–∏—Ä–∫—É–ª—è—Ä–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –í `TaskComponent` entity –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –ª–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è —Ü–∏—Ä–∫—É–ª—è—Ä–Ω—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ –º–µ–∂–¥—É `Task` –∏ `EquipmentComponent`.

2. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—Ç `current_location_type = 'machine'` –∏ `current_location_ref = machine_id` –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –º–∏–≥—Ä–∞—Ü–∏–∏ `1732300000000`.

3. **PostgreSQL enum**: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ enum –ø—Ä–∏ –æ—Ç–∫–∞—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏. –ù–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è `task_type_enum` –æ—Å—Ç–∞–Ω—É—Ç—Å—è –≤ –ë–î –¥–∞–∂–µ –ø–æ—Å–ª–µ –æ—Ç–∫–∞—Ç–∞.

4. **ON DELETE –ø–æ–≤–µ–¥–µ–Ω–∏–µ**:
   - `component_movements.component_id` ‚Üí CASCADE (—É–¥–∞–ª—è–µ—Ç—Å—è —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º)
   - `component_movements.related_machine_id` ‚Üí SET NULL (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—è)
   - `task_components.task_id` ‚Üí CASCADE (—É–¥–∞–ª—è–µ—Ç—Å—è —Å –∑–∞–¥–∞—á–µ–π)
   - `task_components.component_id` ‚Üí RESTRICT (–Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π –∫ –∑–∞–¥–∞—á–µ)

---

## ‚úÖ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–§–∞–∑–∞ 1 –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–∞**. –°—Ö–µ–º–∞ –ë–î –≥–æ—Ç–æ–≤–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏:
- ‚úÖ –ü–æ–ª–Ω–æ–≥–æ —É—á—ë—Ç–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –ò—Å—Ç–æ—Ä–∏–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π
- ‚úÖ –¢–∏–ø–æ–≤ –±—É–Ω–∫–µ—Ä–æ–≤ –∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
- ‚úÖ –ó–∞–¥–∞—á –∑–∞–º–µ–Ω—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –°–≤—è–∑–∏ –∑–∞–¥–∞—á —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

**–ì–æ—Ç–æ–≤–æ –∫ –§–∞–∑–µ 2: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Backend API**.

---

**–ê–≤—Ç–æ—Ä**: Claude (Anthropic)
**–ü—Ä–æ–µ–∫—Ç**: VendHub Manager
**–°–ø—Ä–∏–Ω—Ç**: 3
**–î–∞—Ç–∞**: 2025-11-20
