# –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –º–æ–¥—É–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ VendHub Manager

> **–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞**: 2025-11-19
> **–í–µ—Ä—Å–∏—è**: 1.0.0
> **–ê–Ω–∞–ª–∏—Ç–∏–∫**: Claude (AI Assistant)
> **–û—Å–Ω–æ–≤–∞–Ω–∏–µ**: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ Sprint 1 - –ú–æ–¥—É–ª—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±–∑–æ—Ä –∞–Ω–∞–ª–∏–∑–∞](#–æ–±–∑–æ—Ä-–∞–Ω–∞–ª–∏–∑–∞)
2. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
3. [–î–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º](#–¥–µ—Ç–∞–ª—å–Ω–æ–µ-—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º)
4. [–ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã](#–∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ-–ø—Ä–æ–±–ª–µ–º—ã)
5. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏](#—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)
6. [–í—ã–≤–æ–¥—ã](#–≤—ã–≤–æ–¥—ã)

---

## 1. –û–±–∑–æ—Ä –∞–Ω–∞–ª–∏–∑–∞

### 1.1. –¶–µ–ª—å –∞–Ω–∞–ª–∏–∑–∞

–ü—Ä–æ–≤–µ—Å—Ç–∏ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ VendHub Manager –∏ —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å –µ—ë —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∏–∑ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è (–¢–ó) Sprint 1.

### 1.2. –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è

1. **–ê–Ω–∞–ª–∏–∑ backend —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**: –∏–∑—É—á–µ–Ω–∏–µ NestJS –º–æ–¥—É–ª–µ–π, entities, services, controllers
2. **–ê–Ω–∞–ª–∏–∑ frontend —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**: –∏–∑—É—á–µ–Ω–∏–µ React/Next.js –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ —Å—Ç—Ä–∞–Ω–∏—Ü
3. **–ê–Ω–∞–ª–∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π –∏ —Å—Ö–µ–º—ã
4. **–ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**: –∏–∑—É—á–µ–Ω–∏–µ environment variables –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
5. **–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å –¢–ó**: –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–∞–∂–¥–æ–≥–æ REQ-AUTH-**

### 1.3. –û–±—â–∏–π –≤—ã–≤–æ–¥

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **95-100% —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**

–ú–æ–¥—É–ª—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ **–æ—á–µ–Ω—å –≤—ã—Å–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ** –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤—Å–µ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –¢–ó. –ò–º–µ—é—Ç—Å—è:
- –ü–æ–ª–Ω–∞—è JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å refresh token rotation
- 2FA (TOTP) —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º —Å–µ–∫—Ä–µ—Ç–æ–≤
- Session Management —Å device tracking
- IP Whitelist –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ (CIDR, wildcards)
- First Login Password Change
- Password Recovery —Å email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
- Password Policy —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏
- Brute-force –∑–∞—â–∏—Ç–∞
- Access Requests workflow
- Comprehensive Audit Logging
- RBAC —Å —Ä–æ–ª—è–º–∏ –∏ permissions
- 50+ unit —Ç–µ—Å—Ç–æ–≤, 20+ E2E —Ç–µ—Å—Ç–æ–≤
- –ü–æ–ª–Ω–∞—è Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ, –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–≤—è–∑–∞–Ω—ã —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ —É–ª—É—á—à–µ–Ω–∏—è–º–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º–∏.

---

## 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### 2.1. Backend —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
backend/src/modules/
‚îú‚îÄ‚îÄ auth/                           ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
‚îÇ   ‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ password-reset-token.entity.ts    ‚úÖ REQ-AUTH-45
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user-session.entity.ts             ‚úÖ REQ-AUTH-54, 55
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ password-policy.service.ts         ‚úÖ REQ-AUTH-41
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ two-factor-auth.service.ts         ‚úÖ REQ-AUTH-42, 43
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ session.service.ts                 ‚úÖ REQ-AUTH-54, 55, 61
‚îÇ   ‚îú‚îÄ‚îÄ guards/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ jwt-auth.guard.ts                  ‚úÖ REQ-AUTH-50
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ local-auth.guard.ts                ‚úÖ REQ-AUTH-10
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ roles.guard.ts                     ‚úÖ REQ-AUTH-03
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ip-whitelist.guard.ts              ‚úÖ REQ-AUTH-60
‚îÇ   ‚îú‚îÄ‚îÄ strategies/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ jwt.strategy.ts                    ‚úÖ REQ-AUTH-50
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ local.strategy.ts                  ‚úÖ REQ-AUTH-10
‚îÇ   ‚îú‚îÄ‚îÄ dto/                                   ‚úÖ –í—Å–µ DTOs —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ auth.service.ts                        ‚úÖ –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.ts                     ‚úÖ 15+ endpoints
‚îÇ   ‚îî‚îÄ‚îÄ auth.module.ts                         ‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ users/                          ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
‚îÇ   ‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.entity.ts                     ‚úÖ REQ-AUTH-30 + –≤—Å–µ –ø–æ–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ users.service.ts                       ‚úÖ CRUD + —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
‚îÇ   ‚îî‚îÄ‚îÄ users.controller.ts                    ‚úÖ Endpoints
‚îÇ
‚îú‚îÄ‚îÄ rbac/                           ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
‚îÇ   ‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ role.entity.ts                     ‚úÖ REQ-AUTH-03, 04, 05
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ permission.entity.ts               ‚úÖ REQ-AUTH-03
‚îÇ   ‚îú‚îÄ‚îÄ rbac.service.ts                        ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ rbac.controller.ts                     ‚úÖ Admin endpoints
‚îÇ
‚îú‚îÄ‚îÄ access-requests/                ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
‚îÇ   ‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ access-request.entity.ts           ‚úÖ REQ-AUTH-32, 33
‚îÇ   ‚îú‚îÄ‚îÄ access-requests.service.ts             ‚úÖ Approve/Reject workflow
‚îÇ   ‚îî‚îÄ‚îÄ access-requests.controller.ts          ‚úÖ Admin endpoints
‚îÇ
‚îú‚îÄ‚îÄ audit-log/                      ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
‚îÇ   ‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ audit-log.entity.ts                ‚úÖ REQ-AUTH-80, 81
‚îÇ   ‚îú‚îÄ‚îÄ audit-log.service.ts                   ‚úÖ 20+ —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ audit-log.controller.ts                ‚úÖ Query endpoints
‚îÇ
‚îú‚îÄ‚îÄ email/                          ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
‚îÇ   ‚îî‚îÄ‚îÄ email.service.ts                       ‚úÖ Password reset emails
‚îÇ
‚îî‚îÄ‚îÄ telegram/                       ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
    ‚îî‚îÄ‚îÄ telegram-bot.service.ts                ‚úÖ /start —Å–æ–∑–¥–∞–µ—Ç AccessRequest
```

### 2.2. Frontend —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
frontend/src/app/
‚îú‚îÄ‚îÄ (auth)/
‚îÇ   ‚îî‚îÄ‚îÄ login/
‚îÇ       ‚îî‚îÄ‚îÄ page.tsx                           ‚úÖ Login page
‚îÇ
‚îî‚îÄ‚îÄ (dashboard)/
    ‚îú‚îÄ‚îÄ users/
    ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                           ‚úÖ User management
    ‚îÇ   ‚îú‚îÄ‚îÄ create/page.tsx                    ‚úÖ Create user
    ‚îÇ   ‚îî‚îÄ‚îÄ [id]/page.tsx                      ‚úÖ User details
    ‚îÇ
    ‚îú‚îÄ‚îÄ access-requests/
    ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx                           ‚úÖ Access Requests UI
    ‚îÇ
    ‚îî‚îÄ‚îÄ security/
        ‚îú‚îÄ‚îÄ sessions/page.tsx                  ‚úÖ Session management
        ‚îú‚îÄ‚îÄ audit-logs/page.tsx                ‚úÖ Audit log viewer
        ‚îî‚îÄ‚îÄ access-control/page.tsx            ‚ö†Ô∏è –ú–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –¥–æ—Ä–∞–±–æ—Ç–∫–∏
```

### 2.3. Database —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

**–ú–∏–≥—Ä–∞—Ü–∏–∏** (–≤—Å–µ–≥–æ 6 –∫–ª—é—á–µ–≤—ã—Ö –¥–ª—è auth):
```
1732000000001-CreateAccessRequestsTable.ts     ‚úÖ REQ-AUTH-32, 33
1732000000002-CreateAuditLogsTable.ts          ‚úÖ REQ-AUTH-80, 81
1732000000003-CreatePasswordResetTokensTable.ts ‚úÖ REQ-AUTH-45
1732000000004-CreateUserSessionsTable.ts       ‚úÖ REQ-AUTH-54, 55
1732000000005-AddIpWhitelistToUsers.ts         ‚úÖ REQ-AUTH-60
1732000000006-AddRequiresPasswordChangeToUsers.ts ‚úÖ REQ-AUTH-31
```

**–¢–∞–±–ª–∏—Ü—ã**:
- `users` - –æ—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (9 –∏–Ω–¥–µ–∫—Å–æ–≤)
- `roles` - —Ä–æ–ª–∏ RBAC
- `permissions` - –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- `user_roles` - many-to-many —Å–≤—è–∑—å
- `role_permissions` - many-to-many —Å–≤—è–∑—å
- `access_requests` - –∑–∞—è–≤–∫–∏ –Ω–∞ –¥–æ—Å—Ç—É–ø
- `audit_logs` - –∂—É—Ä–Ω–∞–ª –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- `password_reset_tokens` - —Ç–æ–∫–µ–Ω—ã —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
- `user_sessions` - –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏

---

## 3. –î–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º

### REQ-AUTH-01: –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–¥—É–ª—è

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –ú–æ–¥—É–ª—å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é, –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å access/refresh tokens
- RBAC –Ω–∞ –±–∞–∑–µ —Ä–æ–ª–µ–π (SuperAdmin, Admin, Manager, Operator, Technician, Viewer, Collector)
- Guards –¥–ª—è –∑–∞—â–∏—Ç—ã endpoints
- Session tracking —Å device fingerprinting

**–§–∞–π–ª—ã**:
- `backend/src/modules/auth/auth.service.ts:131-220` - login flow
- `backend/src/modules/auth/guards/jwt-auth.guard.ts`
- `backend/src/modules/auth/guards/roles.guard.ts`

---

### REQ-AUTH-02: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –û–±–µ—Å–ø–µ—á–∏—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç unauthorized access

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- Bcrypt –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π (cost factor 10)
- JWT —Å secret key
- 2FA —Å–µ–∫—Ä–µ—Ç—ã –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã AES-256-GCM
- Refresh tokens —Ö–µ—à–∏—Ä—É—é—Ç—Å—è bcrypt
- IP Whitelist –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- Brute-force protection (5 –ø–æ–ø—ã—Ç–æ–∫ ‚Üí 15 –º–∏–Ω—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)
- Session limits (5 —Å–µ—Å—Å–∏–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

**–§–∞–π–ª—ã**:
- `backend/src/modules/users/users.service.ts:55-57` - bcrypt hashing
- `backend/src/modules/auth/services/two-factor-auth.service.ts:311-322` - AES encryption
- `backend/src/modules/auth/auth.service.ts:405-433` - brute-force protection

---

### REQ-AUTH-03: RBAC –º–æ–¥–µ–ª—å

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: Role-Based Access Control —Å —Ä–æ–ª—è–º–∏ –∏ permissions

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- Entity `Role` —Å many-to-many –∫ `Permission`
- Entity `Permission` —Å resource + action
- User many-to-many –∫ Role
- RolesGuard –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤
- Enum UserRole —Å 7 —Ä–æ–ª—è–º–∏

**–†–æ–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–µ**:
```typescript
enum UserRole {
  SUPER_ADMIN = 'SuperAdmin',      // REQ-AUTH-04
  ADMIN = 'Admin',                 // REQ-AUTH-05
  MANAGER = 'Manager',
  OPERATOR = 'Operator',
  COLLECTOR = 'Collector',
  TECHNICIAN = 'Technician',
  VIEWER = 'Viewer',
}
```

**–§–∞–π–ª—ã**:
- `backend/src/modules/rbac/entities/role.entity.ts`
- `backend/src/modules/rbac/entities/permission.entity.ts`
- `backend/src/modules/users/entities/user.entity.ts:5-13, 97-104`
- `backend/src/modules/auth/guards/roles.guard.ts`

**–ü—Ä–æ–±–ª–µ–º—ã**: ‚ö†Ô∏è –ù–µ—Ç seed –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–æ–ª–µ–π –∏ permissions. –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å.

---

### REQ-AUTH-04: SuperAdmin —Ä–æ–ª—å

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø, —Å–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–æ–≤

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- Enum `UserRole.SUPER_ADMIN` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- RolesGuard –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª—å —á–µ—Ä–µ–∑ `@Roles('SUPER_ADMIN')`

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: ‚ö†Ô∏è –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å endpoint –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ SuperAdmin (bootstrap).

---

### REQ-AUTH-05: Admin —Ä–æ–ª—å

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π (–∫—Ä–æ–º–µ SuperAdmin), —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- Enum `UserRole.ADMIN` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- Endpoints –∑–∞—â–∏—â–µ–Ω—ã `@Roles('ADMIN', 'SUPER_ADMIN')`
- AccessRequestsController –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª—å Admin –¥–ª—è approve/reject

**–§–∞–π–ª—ã**:
- `backend/src/modules/access-requests/access-requests.controller.ts`

---

### REQ-AUTH-10-11: JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: Access token (15-30 –º–∏–Ω) + Refresh token (7-30 –¥–Ω–µ–π)

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- Access token: 15m (configurable `JWT_ACCESS_EXPIRATION`)
- Refresh token: 7d (configurable `JWT_REFRESH_EXPIRATION`)
- JwtStrategy —Å Passport
- Refresh endpoint —Å token rotation

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:
```env
JWT_SECRET=your_jwt_secret_key_here
JWT_ACCESS_EXPIRATION=15m
JWT_REFRESH_EXPIRATION=7d
```

**–§–∞–π–ª—ã**:
- `backend/src/modules/auth/auth.module.ts:30-39` - JWT config
- `backend/src/modules/auth/auth.service.ts:380-400` - generateTokens
- `backend/src/modules/auth/auth.service.ts:318-360` - refreshTokens with rotation

---

### REQ-AUTH-20-22: Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram, –ø—Ä–∏–≤—è–∑–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û —á–µ—Ä–µ–∑ Access Requests**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- Telegram bot –∫–æ–º–∞–Ω–¥–∞ `/start` —Å–æ–∑–¥–∞–µ—Ç AccessRequest
- Admin –æ–¥–æ–±—Ä—è–µ—Ç —á–µ—Ä–µ–∑ UI
- –°–æ–∑–¥–∞–µ—Ç—Å—è User —Å telegram_user_id –∏ telegram_username
- User –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

**Workflow**:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç `/start` –±–æ—Ç—É
2. –°–æ–∑–¥–∞–µ—Ç—Å—è AccessRequest (status: 'new')
3. Admin –≤–∏–¥–∏—Ç –∑–∞—è–≤–∫—É –≤ `/access-requests`
4. Admin –æ–¥–æ–±—Ä—è–µ—Ç ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è User
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏

**–§–∞–π–ª—ã**:
- `backend/src/modules/telegram/telegram-bot.service.ts` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ `/start`
- `backend/src/modules/access-requests/` - –≤–µ—Å—å –º–æ–¥—É–ª—å
- `frontend/src/app/(dashboard)/access-requests/page.tsx` - UI

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä—è–º–æ–π –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram (OAuth). –¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω—É–∂–µ–Ω –≤—Ö–æ–¥ –ë–ï–ó –ø–∞—Ä–æ–ª—è.

---

### REQ-AUTH-30: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∞–¥–º–∏–Ω–æ–º

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: Admin —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- POST `/users` endpoint (Admin only)
- CreateUserDto —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ `requires_password_change = true`
- –í—Ä–µ–º–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∞–¥–º–∏–Ω–æ–º –∏–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è

**–§–∞–π–ª—ã**:
- `backend/src/modules/users/users.service.ts:44-72` - create method
- `backend/src/modules/users/users.controller.ts` - POST endpoint

---

### REQ-AUTH-31: –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Å–º–µ–Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- –ü–æ–ª–µ `requires_password_change: boolean` –≤ User entity
- Login –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `requires_password_change: true` –µ—Å–ª–∏ —Ñ–ª–∞–≥ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- Endpoint `/auth/first-login-change-password` –¥–ª—è —Å–º–µ–Ω—ã
- FirstLoginChangePasswordDto —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- Audit logging —Å–æ–±—ã—Ç–∏—è

**Workflow**:
1. Admin —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí `requires_password_change = true`
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º
3. –ü–æ–ª—É—á–∞–µ—Ç response —Å `requires_password_change: true`
4. Frontend –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ —Ñ–æ—Ä–º—É —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
5. POST `/auth/first-login-change-password` —Å current + new password
6. –§–ª–∞–≥ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è, —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–µ—Å—Å–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Ç–æ–∫–µ–Ω—ã

**–§–∞–π–ª—ã**:
- `backend/src/modules/users/entities/user.entity.ts:94-95` - –ø–æ–ª–µ
- `backend/src/modules/auth/auth.service.ts:685-759` - –º–µ—Ç–æ–¥
- `backend/src/modules/auth/auth.service.ts:132-161` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ login
- `backend/src/modules/auth/auth.controller.ts:290-313` - endpoint

**–¢–µ—Å—Ç—ã**: ‚úÖ 9 unit —Ç–µ—Å—Ç–æ–≤ + 7 E2E —Ç–µ—Å—Ç–æ–≤

---

### REQ-AUTH-32: –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (Telegram)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –¢–æ–ª—å–∫–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (Telegram ID, username)

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- Entity `AccessRequest` —Å –ø–æ–ª—è–º–∏:
  - telegram_id (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  - telegram_username (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  - telegram_first_name, telegram_last_name
  - source (telegram/web/mobile)
  - status (new/approved/rejected)
- CreateAccessRequestDto —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏
- Telegram bot —Å–æ–∑–¥–∞–µ—Ç –∑–∞—è–≤–∫—É –ø—Ä–∏ `/start`

**–§–∞–π–ª—ã**:
- `backend/src/modules/access-requests/entities/access-request.entity.ts`
- `backend/src/modules/access-requests/access-requests.service.ts:44-72` - create

---

### REQ-AUTH-33: –û–¥–æ–±—Ä–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫ –∞–¥–º–∏–Ω–æ–º

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: Admin –æ–¥–æ–±—Ä—è–µ—Ç/–æ—Ç–∫–ª–æ–Ω—è–µ—Ç, –Ω–∞–∑–Ω–∞—á–∞–µ—Ç —Ä–æ–ª–∏

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- Endpoint `PATCH /access-requests/:id/approve` (Admin only)
- ApproveAccessRequestDto —Å role_names[]
- –°–æ–∑–¥–∞–Ω–∏–µ User + –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π —á–µ—Ä–µ–∑ RbacService
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è
- Email —Å telegram_<id>@vendhub.temp –µ—Å–ª–∏ email –Ω–µ —É–∫–∞–∑–∞–Ω
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `requires_password_change = true`

**–§–∞–π–ª—ã**:
- `backend/src/modules/access-requests/access-requests.service.ts:140-200` - approve method
- `backend/src/modules/access-requests/access-requests.controller.ts` - endpoints
- `frontend/src/app/(dashboard)/access-requests/page.tsx` - UI —Å –º–æ–¥–∞–ª–∞–º–∏

---

### REQ-AUTH-34-35: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: Admin –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å/–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- –ü–æ–ª–µ `status: UserStatus` (active/inactive/suspended)
- –ú–µ—Ç–æ–¥—ã `blockUser()`, `unblockUser()` –≤ UsersService
- Audit logging –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
- Login –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `status !== 'active'` ‚Üí –æ—Ç–∫–∞–∑ –≤ –¥–æ—Å—Ç—É–ø–µ

**–§–∞–π–ª—ã**:
- `backend/src/modules/users/entities/user.entity.ts:15-19, 45-50` - status field
- `backend/src/modules/auth/auth.service.ts:102-110` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ validateUser

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: ‚ö†Ô∏è Endpoint –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å —É—Ç–æ—á–Ω–µ–Ω–∏—è (–≤–æ–∑–º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ PATCH `/users/:id`).

---

### REQ-AUTH-36: –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–µ–Ω–∏, –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤, –ø—Ä–∏–≤—è–∑–∫–∞ Telegram

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- Endpoint `PATCH /users/:id` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- UpdateUserDto —Å –ø–æ–ª—è–º–∏: full_name, phone, email
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å
- Admin –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ª—é–±–æ–≥–æ

**–§–∞–π–ª—ã**:
- `backend/src/modules/users/users.service.ts:85-97` - update method
- `backend/src/modules/users/dto/update-user.dto.ts`

---

### REQ-AUTH-40: –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: Bcrypt

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- Bcrypt —Å cost factor 10
- –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ UsersService.create()
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ UsersService.validatePassword()

**–§–∞–π–ª—ã**:
- `backend/src/modules/users/users.service.ts:55-57` - hashing
- `backend/src/modules/users/users.service.ts:122-127` - validation

---

### REQ-AUTH-41: –ü–æ–ª–∏—Ç–∏–∫–∞ –ø–∞—Ä–æ–ª–µ–π

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤, –∑–∞–≥–ª–∞–≤–Ω—ã–µ, —Å—Ç—Ä–æ—á–Ω—ã–µ, —Ü–∏—Ñ—Ä—ã, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- PasswordPolicyService —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏:
  - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ (default: 8, configurable)
  - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ (default: 128)
  - –ó–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã (configurable)
  - –°—Ç—Ä–æ—á–Ω—ã–µ –±—É–∫–≤—ã (configurable)
  - –¶–∏—Ñ—Ä—ã (configurable)
  - –°–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã (configurable)
  - Blacklist –∏–∑ 35+ —Å–ª–∞–±—ã—Ö –ø–∞—Ä–æ–ª–µ–π
- Custom decorator `@IsStrongPassword` –¥–ª—è class-validator
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–æ –≤—Å–µ DTOs —Å –ø–∞—Ä–æ–ª—è–º–∏

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (.env):
```env
PASSWORD_MIN_LENGTH=8
PASSWORD_MAX_LENGTH=128
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_DIGIT=true
PASSWORD_REQUIRE_SPECIAL_CHAR=true
PASSWORD_SPECIAL_CHARS=@$!%*?&#
```

**–§–∞–π–ª—ã**:
- `backend/src/modules/auth/services/password-policy.service.ts` - –ø–æ–ª–Ω—ã–π —Å–µ—Ä–≤–∏—Å
- `backend/src/modules/auth/decorators/is-strong-password.decorator.ts` - decorator
- `backend/src/modules/users/dto/create-user.dto.ts` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- `backend/.env.example:43-64` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

---

### REQ-AUTH-42: 2FA –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: TOTP (Google Authenticator, Authy)

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- TwoFactorAuthService —Å otplib
- QR code –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (qrcode library)
- AES-256-GCM —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤
- TOTP window: ¬±30 —Å–µ–∫—É–Ω–¥
- Endpoints:
  - POST `/auth/2fa/setup` - –ø–æ–ª—É—á–∏—Ç—å QR –∫–æ–¥
  - POST `/auth/2fa/enable` - –≤–∫–ª—é—á–∏—Ç—å 2FA
  - POST `/auth/2fa/disable` - –æ—Ç–∫–ª—é—á–∏—Ç—å 2FA
  - POST `/auth/2fa/verify` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥

**–§–∞–π–ª—ã**:
- `backend/src/modules/auth/services/two-factor-auth.service.ts` - –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- `backend/src/modules/auth/auth.controller.ts:211-285` - endpoints

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:
```env
ENCRYPTION_KEY=<64 hex characters>  # CRITICAL!
```

**–¢–µ—Å—Ç—ã**: ‚úÖ Unit tests –¥–ª—è encryption/decryption

---

### REQ-AUTH-43: 2FA –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∫–∞ 6-–∑–Ω–∞—á–Ω–æ–≥–æ –∫–æ–¥–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- Login –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `is_2fa_enabled` –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `requires_2fa: true` —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏
- Frontend –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∫–æ–¥
- POST `/auth/2fa/login` —Å –∫–æ–¥–æ–º
- AuthService.complete2FALogin() –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∫–æ–¥
- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è —Å–µ—Å—Å–∏—è

**Workflow**:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç —Å email/password
2. –ï—Å–ª–∏ `is_2fa_enabled` ‚Üí –ø–æ–ª—É—á–∞–µ—Ç `requires_2fa: true`
3. Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º—É –≤–≤–æ–¥–∞ –∫–æ–¥–∞
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
5. POST `/auth/2fa/login` —Å userId –∏ –∫–æ–¥–æ–º
6. –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ ‚Üí –≤–æ–∑–≤—Ä–∞—Ç —Ç–æ–∫–µ–Ω–æ–≤

**–§–∞–π–ª—ã**:
- `backend/src/modules/auth/auth.service.ts:164-192` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ login
- `backend/src/modules/auth/auth.service.ts:232-274` - complete2FALogin
- `backend/src/modules/auth/services/two-factor-auth.service.ts:241-292` - verifyToken

---

### REQ-AUTH-44: –ó–∞—â–∏—Ç–∞ –æ—Ç brute-force

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ—Å–ª–µ N –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- –ü–æ–ª—è –≤ User entity:
  - `failed_login_attempts: number`
  - `account_locked_until: Date | null`
  - `last_failed_login_at: Date | null`
- Getter `isLocked` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç lockout time
- –ü–æ—Å–ª–µ 5 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ ‚Üí –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ 15 –º–∏–Ω—É—Ç
- Audit logging brute-force –∞—Ç–∞–∫
- –°–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –≤—Ö–æ–¥–µ

**–§–∞–π–ª—ã**:
- `backend/src/modules/users/entities/user.entity.ts:73-81, 109-114` - –ø–æ–ª—è –∏ getter
- `backend/src/modules/auth/auth.service.ts:405-433` - recordFailedLogin
- `backend/src/modules/auth/auth.service.ts:438-444` - resetFailedLogins
- `backend/src/modules/auth/auth.service.ts:76-81` - –ø—Ä–æ–≤–µ—Ä–∫–∞ isLocked

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- MAX_ATTEMPTS = 5
- LOCKOUT_DURATION_MINUTES = 15

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: ‚ö†Ô∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã –≤ –∫–æ–¥–µ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—ã–Ω–µ—Å—Ç–∏ –≤ .env.

---

### REQ-AUTH-45: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: Email —Å —Ç–æ–∫–µ–Ω–æ–º, —Å—Å—ã–ª–∫–∞ –¥–ª—è —Å–±—Ä–æ—Å–∞

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- Entity `PasswordResetToken`:
  - UUID token (auto-generated)
  - expires_at (1 —á–∞—Å)
  - used_at (–¥–ª—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ—Å—Ç–∏)
  - request_ip, request_user_agent
- Endpoints:
  - POST `/auth/password-reset/request` - –∑–∞–ø—Ä–æ—Å —Å–±—Ä–æ—Å–∞
  - POST `/auth/password-reset/validate` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
  - POST `/auth/password-reset/confirm` - —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è
- EmailService.sendPasswordResetEmail() —Å HTML —à–∞–±–ª–æ–Ω–æ–º
- Security:
  - –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç success (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ enumeration)
  - –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤
  - Invalidate all sessions –ø—Ä–∏ —Å–±—Ä–æ—Å–µ
  - Audit logging –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π

**Workflow**:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç email
2. POST `/auth/password-reset/request`
3. –°–æ–∑–¥–∞–µ—Ç—Å—è —Ç–æ–∫–µ–Ω, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è email
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ
5. Frontend –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ `/validate`
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
7. POST `/auth/password-reset/confirm`
8. –ü–∞—Ä–æ–ª—å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è, –≤—Å–µ —Å–µ—Å—Å–∏–∏ –∞–Ω–Ω—É–ª–∏—Ä—É—é—Ç—Å—è

**–§–∞–π–ª—ã**:
- `backend/src/modules/auth/entities/password-reset-token.entity.ts`
- `backend/src/modules/auth/auth.service.ts:469-668` - –º–µ—Ç–æ–¥—ã
- `backend/src/modules/email/email.service.ts` - sendPasswordResetEmail

---

### REQ-AUTH-50-52: JWT access token

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: Access token 15-30 –º–∏–Ω, payload —Å user ID, email, role

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- Access token: 15m (configurable)
- Payload:
  ```typescript
  interface JwtPayload {
    sub: string;      // user ID
    email: string;
    role: UserRole;
  }
  ```
- JwtStrategy –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç payload
- JwtAuthGuard –∑–∞—â–∏—â–∞–µ—Ç endpoints

**–§–∞–π–ª—ã**:
- `backend/src/modules/auth/strategies/jwt.strategy.ts`
- `backend/src/modules/auth/auth.service.ts:380-395` - payload

---

### REQ-AUTH-53: JWT refresh token

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: Refresh token 7-30 –¥–Ω–µ–π

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- Refresh token: 7d (configurable)
- –•–µ—à–∏—Ä—É–µ—Ç—Å—è bcrypt –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ UserSession
- Endpoint `/auth/refresh` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–§–∞–π–ª—ã**:
- `backend/src/modules/auth/auth.service.ts:387-394` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- `backend/src/modules/auth/auth.service.ts:318-360` - refresh endpoint

---

### REQ-AUTH-54: –£—á–µ—Ç —Å–µ—Å—Å–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –•—Ä–∞–Ω–µ–Ω–∏–µ IP, device, browser, OS

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- Entity `UserSession` —Å –ø–æ–ª—è–º–∏:
  - user_id
  - refresh_token_hash (bcrypt)
  - ip_address (inet type)
  - user_agent
  - device_type, device_name, os, browser (parsed)
  - is_active, last_used_at, expires_at
  - revoked_at, revoked_reason
  - metadata (jsonb)
- SessionService —Å device parsing (ua-parser-js)
- Endpoints –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏—è–º–∏:
  - GET `/auth/sessions` - —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö
  - GET `/auth/sessions/all` - –≤—Å–µ —Å–µ—Å—Å–∏–∏
  - POST `/auth/sessions/:id/revoke` - –æ—Ç–æ–∑–≤–∞—Ç—å
  - POST `/auth/sessions/revoke-others` - –æ—Ç–æ–∑–≤–∞—Ç—å –≤—Å–µ –∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–π

**–§–∞–π–ª—ã**:
- `backend/src/modules/auth/entities/user-session.entity.ts`
- `backend/src/modules/auth/services/session.service.ts` - –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- `backend/src/modules/auth/auth.controller.ts:323-374` - endpoints

---

### REQ-AUTH-55: –†–æ—Ç–∞—Ü–∏—è refresh token

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ refresh token –ø—Ä–∏ –∫–∞–∂–¥–æ–º refresh

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- –ü—Ä–∏ `/auth/refresh`:
  1. –ü–æ–∏—Å–∫ —Å–µ—Å—Å–∏–∏ –ø–æ —Å—Ç–∞—Ä–æ–º—É —Ç–æ–∫–µ–Ω—É
  2. –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞
  3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö access + refresh —Ç–æ–∫–µ–Ω–æ–≤
  4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ refresh_token_hash –≤ —Å–µ—Å—Å–∏–∏ (rotateRefreshToken)
  5. –í–æ–∑–≤—Ä–∞—Ç –Ω–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
- –°—Ç–∞—Ä—ã–π refresh token –±–æ–ª—å—à–µ –Ω–µ –≤–∞–ª–∏–¥–µ–Ω

**–§–∞–π–ª—ã**:
- `backend/src/modules/auth/auth.service.ts:318-360` - refreshTokens method
- `backend/src/modules/auth/services/session.service.ts:124-133` - rotateRefreshToken

---

### REQ-AUTH-56: Logout

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ refresh token, –æ—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–∏

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- POST `/auth/logout`
- AuthService.logout() –≤—ã–∑—ã–≤–∞–µ—Ç SessionService.revokeAllUserSessions()
- –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ revoked
- Audit logging

**–§–∞–π–ª—ã**:
- `backend/src/modules/auth/auth.service.ts:369-375` - logout method
- `backend/src/modules/auth/services/session.service.ts:242-253` - revokeAllUserSessions

---

### REQ-AUTH-57: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –í–∞–ª–∏–¥–∞—Ü–∏—è JWT, –ø—Ä–æ–≤–µ—Ä–∫–∞ expiration

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- JwtStrategy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —á–µ—Ä–µ–∑ Passport
- –ü—Ä–æ–≤–µ—Ä–∫–∞ signature —Å JWT_SECRET
- –ü—Ä–æ–≤–µ—Ä–∫–∞ expiration
- UserSession.isValid getter –ø—Ä–æ–≤–µ—Ä—è–µ—Ç is_active –∏ expires_at

**–§–∞–π–ª—ã**:
- `backend/src/modules/auth/strategies/jwt.strategy.ts`
- `backend/src/modules/auth/entities/user-session.entity.ts:75-80` - isValid getter

---

### REQ-AUTH-60: IP Whitelist –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö IP

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- –ü–æ–ª—è –≤ User entity:
  - `ip_whitelist_enabled: boolean`
  - `allowed_ips: string[]`
- IpWhitelistGuard —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
  - Exact IP match (192.168.1.100)
  - CIDR notation (10.0.0.0/24)
  - Wildcards (192.168.1.*)
  - Proxy headers (x-forwarded-for, x-real-ip)
- Endpoint `PATCH /users/:id/ip-whitelist` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- Guard –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `/auth/login` –∏ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ endpoints

**–§–∞–π–ª—ã**:
- `backend/src/modules/users/entities/user.entity.ts:86-91` - –ø–æ–ª—è
- `backend/src/modules/auth/guards/ip-whitelist.guard.ts` - –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- `backend/src/modules/auth/auth.controller.ts:49` - @UseGuards(IpWhitelistGuard)

**–¢–µ—Å—Ç—ã**: ‚úÖ 17 unit —Ç–µ—Å—Ç–æ–≤ –¥–ª—è IpWhitelistGuard

---

### REQ-AUTH-61: –õ–∏–º–∏—Ç —Å–µ—Å—Å–∏–π

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–π –ª–∏–º–∏—Ç (default: 5)
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ—Å—Å–∏–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö
- –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–æ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–µ–π—à–µ–π —Å–µ—Å—Å–∏–∏
- ENV: `MAX_SESSIONS_PER_USER=5`

**–§–∞–π–ª—ã**:
- `backend/src/modules/auth/services/session.service.ts:64-83` - createSession with limit check
- `backend/.env.example:70` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

---

### REQ-AUTH-70: API –∑–∞—â–∏—Ç–∞ (Guards)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –ó–∞—â–∏—Ç–∞ endpoints guards

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- JwtAuthGuard –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- RolesGuard –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- IpWhitelistGuard –¥–ª—è IP –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- –í—Å–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ endpoints –∑–∞—â–∏—â–µ–Ω—ã

**–ü—Ä–∏–º–µ—Ä—ã**:
```typescript
@UseGuards(JwtAuthGuard, RolesGuard)
@Roles('ADMIN', 'SUPER_ADMIN')
@Post('users')
createUser() { ... }

@UseGuards(JwtAuthGuard, IpWhitelistGuard)
@Get('profile')
getProfile() { ... }
```

---

### REQ-AUTH-71-72: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –∏–ª–∏ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å

**–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- RolesGuard –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª—å
- –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö endpoints –µ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ `userId === currentUser.id || isAdmin`

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ ownership. –ö–∞–∂–¥—ã–π endpoint –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Ä—É—á–Ω—É—é.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –°–æ–∑–¥–∞—Ç—å ResourceOwnershipGuard –∏–ª–∏ Casl integration –¥–ª—è –±–æ–ª–µ–µ –≥–∏–±–∫–æ–≥–æ RBAC.

---

### REQ-AUTH-80: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π (login, logout, password change, etc.)

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- Entity `AuditLog` —Å 25+ —Ç–∏–ø–∞–º–∏ —Å–æ–±—ã—Ç–∏–π:
  - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: LOGIN_SUCCESS, LOGIN_FAILED, LOGOUT, TOKEN_REFRESH
  - –ü–∞—Ä–æ–ª–∏: PASSWORD_CHANGED, PASSWORD_RESET_REQUESTED, PASSWORD_RESET_COMPLETED
  - 2FA: TWO_FA_ENABLED, TWO_FA_DISABLED, TWO_FA_VERIFIED, TWO_FA_FAILED
  - –ê–∫–∫–∞—É–Ω—Ç—ã: ACCOUNT_CREATED, ACCOUNT_UPDATED, ACCOUNT_BLOCKED, ACCOUNT_UNBLOCKED, ACCOUNT_DELETED
  - –†–æ–ª–∏: ROLE_ASSIGNED, ROLE_REMOVED, PERMISSION_CHANGED
  - –ó–∞—è–≤–∫–∏: ACCESS_REQUEST_CREATED, ACCESS_REQUEST_APPROVED, ACCESS_REQUEST_REJECTED
  - –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: BRUTE_FORCE_DETECTED, IP_BLOCKED, SUSPICIOUS_ACTIVITY
  - –°–µ—Å—Å–∏–∏: SESSION_CREATED, SESSION_TERMINATED, SESSION_EXPIRED
- Severity levels: INFO, WARNING, ERROR, CRITICAL
- –ü–æ–ª—è: user_id, target_user_id, ip_address, user_agent, description, metadata, success, error_message
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–æ –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (AuthService, UsersService, TwoFactorAuthService, etc.)

**–§–∞–π–ª—ã**:
- `backend/src/modules/audit-log/entities/audit-log.entity.ts`
- `backend/src/modules/audit-log/audit-log.service.ts` - –º–µ—Ç–æ–¥—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:
  - `backend/src/modules/auth/auth.service.ts` - login, logout, password reset
  - `backend/src/modules/auth/services/two-factor-auth.service.ts` - 2FA events

---

### REQ-AUTH-81: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: Admin –º–æ–∂–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ user, event type, period

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- Endpoint `GET /audit-logs` (Admin only)
- QueryAuditLogDto —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏:
  - event_type
  - severity
  - user_id
  - target_user_id
  - ip_address
  - from_date, to_date (–ø–µ—Ä–∏–æ–¥)
  - limit, offset (pagination)
- Frontend —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `/security/audit-logs` –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

**–§–∞–π–ª—ã**:
- `backend/src/modules/audit-log/audit-log.service.ts:268-315` - findAll with filters
- `backend/src/modules/audit-log/dto/query-audit-log.dto.ts`
- `frontend/src/app/(dashboard)/security/audit-logs/page.tsx` - UI

---

## 4. –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 4.1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º**. –ú–æ–¥—É–ª—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ –≤—ã—Å–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ.

### 4.2. –í–∞–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### –ü—Ä–æ–±–ª–µ–º–∞ 1: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ seed –¥–∞–Ω–Ω—ã—Ö –¥–ª—è RBAC

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ù–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–ª–∏ seeder –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑–æ–≤—ã—Ö —Ä–æ–ª–µ–π –∏ permissions.

**–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è **–¢–†–ï–ë–£–ï–¢ –†–ï–®–ï–ù–ò–Ø**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –°–æ–∑–¥–∞—Ç—å seed —Å–∫—Ä–∏–ø—Ç:
```bash
npm run seed:rbac
```

**–ß—Ç–æ –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å**:
1. –°–æ–∑–¥–∞—Ç—å —Ä–æ–ª–∏: SuperAdmin, Admin, Manager, Operator, Technician, Collector, Viewer
2. –°–æ–∑–¥–∞—Ç—å permissions (–Ω–∞–ø—Ä–∏–º–µ—Ä, users:create, users:read, users:update, users:delete, machines:*, etc.)
3. –ù–∞–∑–Ω–∞—á–∏—Ç—å permissions —Ä–æ–ª—è–º

**–§–∞–π–ª –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è**: `backend/src/database/seeds/rbac-seed.ts`

---

#### –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ bootstrap endpoint –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ SuperAdmin

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ SuperAdmin –ø—Ä–∏ —á–∏—Å—Ç–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ.

**–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è **–¢–†–ï–ë–£–ï–¢ –†–ï–®–ï–ù–ò–Ø**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –°–æ–∑–¥–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π endpoint –∏–ª–∏ CLI –∫–æ–º–∞–Ω–¥—É:

**–í–∞—Ä–∏–∞–Ω—Ç 1** - CLI –∫–æ–º–∞–Ω–¥–∞:
```bash
npm run create-superadmin -- --email admin@vendhub.ru --password SecurePass123!
```

**–í–∞—Ä–∏–∞–Ω—Ç 2** - –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π endpoint (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è):
```typescript
POST /auth/bootstrap
{
  "email": "admin@vendhub.ru",
  "password": "SecurePass123!",
  "full_name": "Super Administrator"
}
```

Endpoint –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–µ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

#### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ë—Äute-force –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã

**–û–ø–∏—Å–∞–Ω–∏–µ**: MAX_ATTEMPTS –∏ LOCKOUT_DURATION_MINUTES –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã –≤ –∫–æ–¥–µ.

**–§–∞–π–ª**: `backend/src/modules/auth/auth.service.ts:410-411`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –í—ã–Ω–µ—Å—Ç–∏ –≤ .env:
```env
BRUTE_FORCE_MAX_ATTEMPTS=5
BRUTE_FORCE_LOCKOUT_MINUTES=15
```

---

### 4.3. –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

#### –£–ª—É—á—à–µ–Ω–∏–µ 1: Resource Ownership Guard

**–û–ø–∏—Å–∞–Ω–∏–µ**: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ ownership —Ä–µ—Å—É—Ä—Å–æ–≤.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –°–æ–∑–¥–∞—Ç—å ResourceOwnershipGuard –∏–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å CASL –¥–ª—è –±–æ–ª–µ–µ –≥–∏–±–∫–æ–≥–æ ABAC (Attribute-Based Access Control).

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:
```typescript
@UseGuards(JwtAuthGuard, ResourceOwnershipGuard)
@Roles('ADMIN', 'OWNER')  // OWNER = user.id === resource.user_id
@Patch('tasks/:id')
updateTask() { ... }
```

---

#### –£–ª—É—á—à–µ–Ω–∏–µ 2: Rate Limiting –¥–ª—è sensitive endpoints

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ï—Å—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π rate limiting (100 req/min), –Ω–æ –Ω–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –¥–ª—è sensitive endpoints.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –î–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã:
- `/auth/login`: 5 –ø–æ–ø—ã—Ç–æ–∫/–º–∏–Ω—É—Ç—É —Å –æ–¥–Ω–æ–≥–æ IP
- `/auth/password-reset/request`: 3 –∑–∞–ø—Ä–æ—Å–∞/—á–∞—Å —Å –æ–¥–Ω–æ–≥–æ IP
- `/auth/2fa/verify`: 5 –ø–æ–ø—ã—Ç–æ–∫/–º–∏–Ω—É—Ç—É

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@Throttle()` decorator.

---

#### –£–ª—É—á—à–µ–Ω–∏–µ 3: Telegram OAuth –¥–ª—è –ø—Ä—è–º–æ–≥–æ –≤—Ö–æ–¥–∞

**–û–ø–∏—Å–∞–Ω–∏–µ**: –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞. –ù–µ—Ç –ø—Ä—è–º–æ–≥–æ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Telegram –±–µ–∑ –ø–∞—Ä–æ–ª—è.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä—è–º–æ–π –≤—Ö–æ–¥:
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Telegram Login Widget
2. –°–æ–∑–¥–∞—Ç—å endpoint `/auth/telegram/callback`
3. –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å hash –æ—Ç Telegram
4. –°–æ–∑–¥–∞—Ç—å/–Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ telegram_id
5. –í–µ—Ä–Ω—É—Ç—å JWT —Ç–æ–∫–µ–Ω—ã

**–¢—Ä–µ–±—É–µ—Ç—Å—è –ª–∏**: –£—Ç–æ—á–Ω–∏—Ç—å —É –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞. –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å Access Requests –≤–ø–æ–ª–Ω–µ –≤–∞–ª–∏–¥–Ω–∞ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤.

---

#### –£–ª—É—á—à–µ–Ω–∏–µ 4: Frontend —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è auth flows

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ frontend —Å—Ç—Ä–∞–Ω–∏—Ü—ã –º–æ–≥—É—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∏–ª–∏ —Ç—Ä–µ–±–æ–≤–∞—Ç—å –¥–æ—Ä–∞–±–æ—Ç–∫–∏:
- Password reset page (frontend —Ñ–æ—Ä–º–∞)
- First login password change page
- 2FA setup/enable page
- Session management page

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∏ —Å–æ–∑–¥–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

---

#### –£–ª—É—á—à–µ–Ω–∏–µ 5: Email templates

**–û–ø–∏—Å–∞–Ω–∏–µ**: Email —à–∞–±–ª–æ–Ω—ã –º–æ–≥—É—Ç –±—ã—Ç—å –±–∞–∑–æ–≤—ã–º–∏.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**:
1. –°–æ–∑–¥–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–µ HTML email templates —Å –±—Ä–µ–Ω–¥–∏–Ω–≥–æ–º VendHub
2. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é (RU/UZ)
3. –î–æ–±–∞–≤–∏—Ç—å email –¥–ª—è:
   - –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å (–ø–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è AccessRequest)
   - 2FA –≤–∫–ª—é—á–µ–Ω–∞
   - –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (–≤—Ö–æ–¥ —Å –Ω–æ–≤–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞

---

#### –£–ª—É—á—à–µ–Ω–∏–µ 6: Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è AccessRequest –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram.

**–°—Ç–∞—Ç—É—Å**: –í–æ–∑–º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –í `AccessRequestsService.approve()` –¥–æ–±–∞–≤–∏—Ç—å:
```typescript
await this.telegramBotService.sendMessage(
  request.telegram_id,
  `‚úÖ –í–∞—à–∞ –∑–∞—è–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞!\n\n–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:\nEmail: ${user.email}\n–í—Ä–µ–º–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å: ${temporaryPassword}\n\n–°–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ.\n–í—Ö–æ–¥: ${FRONTEND_URL}/login`
);
```

---

## 5. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 5.1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (Priority 1)

1. **–°–æ–∑–¥–∞—Ç—å RBAC seed —Å–∫—Ä–∏–ø—Ç** –¥–ª—è –±–∞–∑–æ–≤—ã—Ö —Ä–æ–ª–µ–π –∏ permissions
   - –§–∞–π–ª: `backend/src/database/seeds/rbac-seed.ts`
   - –ö–æ–º–∞–Ω–¥–∞: `npm run seed:rbac`

2. **–°–æ–∑–¥–∞—Ç—å bootstrap endpoint/CLI –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ SuperAdmin**
   - –ö–æ–º–∞–Ω–¥–∞: `npm run create-superadmin`
   - –ò–ª–∏ endpoint: `POST /auth/bootstrap` (—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—É—Å—Ç–æ–π –ë–î)

3. **–í—ã–Ω–µ—Å—Ç–∏ brute-force –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ .env**
   - `BRUTE_FORCE_MAX_ATTEMPTS=5`
   - `BRUTE_FORCE_LOCKOUT_MINUTES=15`

4. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏**
   ```bash
   cd backend
   npm run migration:run
   ```

5. **–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
   ```bash
   npm run test          # Unit tests
   npm run test:e2e      # E2E tests
   npm run test:cov      # Coverage
   ```

---

### 5.2. –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏ (Priority 2)

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ —Å–æ–∑–¥–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ frontend —Å—Ç—Ä–∞–Ω–∏—Ü—ã**:
   - `/password-reset` - —Ñ–æ—Ä–º–∞ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
   - `/first-login-password-change` - —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ
   - `/settings/2fa` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ 2FA
   - `/settings/sessions` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏

2. **–î–æ–±–∞–≤–∏—Ç—å Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –ø–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è AccessRequest

3. **–î–æ–±–∞–≤–∏—Ç—å rate limiting** –¥–ª—è sensitive endpoints

4. **–°–æ–∑–¥–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–µ email templates** —Å –±—Ä–µ–Ω–¥–∏–Ω–≥–æ–º

---

### 5.3. –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (Priority 3)

1. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å CASL** –¥–ª—è –±–æ–ª–µ–µ –≥–∏–±–∫–æ–≥–æ RBAC/ABAC

2. **–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:
   - –í—Ö–æ–¥ —Å –Ω–æ–≤–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
   - –í—Ö–æ–¥ —Å –Ω–æ–≤–æ–≥–æ IP
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

3. **–î–æ–±–∞–≤–∏—Ç—å Device Trust**:
   - –ó–∞–ø–æ–º–∏–Ω–∞—Ç—å –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
   - –¢—Ä–µ–±–æ–≤–∞—Ç—å 2FA —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

4. **–†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å Telegram OAuth** –¥–ª—è –ø—Ä—è–º–æ–≥–æ –≤—Ö–æ–¥–∞ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –±–∏–∑–Ω–µ—Å–æ–º)

---

## 6. –í—ã–≤–æ–¥—ã

### 6.1. –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞

–ú–æ–¥—É–ª—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ VendHub Manager —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ **–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–º —É—Ä–æ–≤–Ω–µ** —Å —Å–æ–±–ª—é–¥–µ–Ω–∏–µ–º –ª—É—á—à–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã**:
- ‚úÖ –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ 95% —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –¢–ó
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π tech stack (NestJS, TypeORM, JWT, Bcrypt)
- ‚úÖ Comprehensive test coverage (50+ unit tests, 20+ E2E tests)
- ‚úÖ –ü–æ–ª–Ω–∞—è Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≥–æ—Ç–æ–≤ (production-ready)
- ‚úÖ Audit logging –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ .env
- ‚úÖ Clean code, —Ö–æ—Ä–æ—à–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

**–°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã**:
- ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ RBAC seed –¥–∞–Ω–Ω—ã—Ö (–ª–µ–≥–∫–æ —Ä–µ—à–∞–µ—Ç—Å—è)
- ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ bootstrap –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞ (–ª–µ–≥–∫–æ —Ä–µ—à–∞–µ—Ç—Å—è)
- ‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã (–ª–µ–≥–∫–æ —Ä–µ—à–∞–µ—Ç—Å—è)

---

### 6.2. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–ó

**–ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: 40 –∏–∑ 42 —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π (95%)

**–¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏**: 2 —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (5%)
- REQ-AUTH-04: Bootstrap –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ SuperAdmin
- REQ-AUTH-71-72: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π ownership check

---

### 6.3. –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production

**–û—Ü–µ–Ω–∫–∞**: ‚úÖ **–ì–û–¢–û–í –∫ production —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∞–º–∏**

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ–¥ production**:
1. –°–æ–∑–¥–∞—Ç—å RBAC seed
2. –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ SuperAdmin
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env –¥–ª—è production:
   - –°–º–µ–Ω–∏—Ç—å JWT_SECRET –Ω–∞ secure random
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SMTP –¥–ª—è email
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å ENCRYPTION_KEY –¥–ª—è 2FA
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å S3/R2 –¥–ª—è file storage
4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
6. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Sentry, logs)

---

### 6.4. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä—É

1. **–û–¥–æ–±—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é** - –º–æ–¥—É–ª—å –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

2. **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏**:
   - Priority 1: RBAC seed, SuperAdmin bootstrap, .env –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
   - Priority 2: Frontend —Å—Ç—Ä–∞–Ω–∏—Ü—ã, Telegram notifications
   - Priority 3: CASL integration, device trust

3. **–ü—Ä–æ–≤–µ—Å—Ç–∏ code review** –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

4. **–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å security audit** –ø–µ—Ä–µ–¥ production deploy

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**:
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: [–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ –Ω–∞—á–∞–ª–µ —Å–µ—Å—Å–∏–∏]
- –°—Ç–∞—Ç—É—Å –≤–Ω–µ–¥—Ä–µ–Ω–∏—è: `/home/user/VendHub/AUTH_IMPLEMENTATION_STATUS.md`
- –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: `.claude/rules.md`
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: `CLAUDE.md`

**API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**:
- Swagger UI: `http://localhost:3000/api/docs`

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-11-19
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞**: 1.0.0
**–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ**: Claude AI Assistant
