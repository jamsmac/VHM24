# Equipment Documentation

> **Модуль**: `backend/src/modules/equipment/`
> **Версия**: 1.0.0
> **Последнее обновление**: 2025-12-20

---

## Обзор

Модуль Equipment управляет компонентами вендинговых аппаратов, их жизненным циклом, обслуживанием и перемещениями.

```
┌─────────────────────────────────────────────────────────────────────┐
│                      EQUIPMENT MODULE                                │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                   COMPONENTS                                 │   │
│  │  ├── 13 типов (hopper, grinder, brewer, mixer, ...)         │   │
│  │  ├── 8 статусов (active, in_stock, needs_maintenance, ...)  │   │
│  │  ├── 5 локаций (machine, warehouse, washing, drying, repair)│   │
│  │  └── Отслеживание ресурса и обслуживания                    │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                   MOVEMENTS                                  │   │
│  │  ├── 10 типов перемещений                                   │   │
│  │  ├── Полная история движений                                │   │
│  │  └── Валидация переходов                                    │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                   MAINTENANCE                                │   │
│  │  ├── 8 типов обслуживания                                   │   │
│  │  ├── Учёт затрат (работа + запчасти)                        │   │
│  │  └── Статистика и отчёты                                    │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                   WASHING SCHEDULES                          │   │
│  │  ├── 5 частот (daily, weekly, biweekly, monthly, custom)    │   │
│  │  ├── Автосоздание задач                                     │   │
│  │  └── Уведомления о просрочке                                │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                   SPARE PARTS & HOPPERS                      │   │
│  │  ├── Каталог запчастей с артикулами                         │   │
│  │  ├── Складской учёт (min/max stock)                         │   │
│  │  └── Справочник типов бункеров                              │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## Документация

| Документ | Описание |
|----------|----------|
| [01-EQUIPMENT-COMPONENTS.md](./01-EQUIPMENT-COMPONENTS.md) | Компоненты: типы, статусы, жизненный цикл |
| [02-COMPONENT-MOVEMENTS.md](./02-COMPONENT-MOVEMENTS.md) | Перемещения: типы, валидация, история |
| [03-MAINTENANCE-SYSTEM.md](./03-MAINTENANCE-SYSTEM.md) | Обслуживание: типы, графики мойки, затраты |
| [04-SPARE-PARTS.md](./04-SPARE-PARTS.md) | Запчасти и типы бункеров |
| [05-EQUIPMENT-API.md](./05-EQUIPMENT-API.md) | REST API Reference |

---

## Быстрый старт

### Создание компонента

```bash
POST /api/equipment/components
{
  "component_type": "hopper",
  "name": "Бункер кофе 1.5кг",
  "serial_number": "HOP-2024-001",
  "maintenance_interval_days": 14
}
```

### Установка в машину

```bash
POST /api/equipment/components/:id/install
{
  "machine_id": "uuid-машины"
}
```

### Отправка на мойку

```bash
POST /api/equipment/components/:id/move
{
  "to_location_type": "washing",
  "movement_type": "send_to_wash"
}
```

### Запись обслуживания

```bash
POST /api/equipment/maintenance
{
  "component_id": "uuid",
  "maintenance_type": "cleaning",
  "duration_minutes": 25,
  "is_successful": true
}
```

---

## Основные сущности

### EquipmentComponent

Основная сущность для учёта компонентов оборудования.

**Ключевые поля:**
- `component_type` - тип компонента (13 типов)
- `status` - текущий статус (8 статусов)
- `current_location_type` - где находится (5 локаций)
- `machine_id` - привязка к аппарату
- `next_maintenance_date` - дата следующего обслуживания

### ComponentMovement

История перемещений компонентов.

**Ключевые поля:**
- `from_location_type` / `to_location_type` - откуда/куда
- `movement_type` - тип перемещения (10 типов)
- `moved_at` - дата/время

### ComponentMaintenance

Записи обслуживания компонентов.

**Ключевые поля:**
- `maintenance_type` - тип работ (8 типов)
- `labor_cost` / `parts_cost` / `total_cost` - затраты
- `is_successful` - результат

### WashingSchedule

Графики регулярной мойки.

**Ключевые поля:**
- `frequency` - частота (5 вариантов)
- `next_wash_date` - дата следующей мойки
- `auto_create_tasks` - автосоздание задач

---

## Типы компонентов

| Код | Название | Требует мойки |
|-----|----------|---------------|
| hopper | Бункер | Да |
| grinder | Кофемолка | Да |
| brewer | Заварочный узел | Да |
| mixer | Миксер | Да |
| cooling_unit | Холодильный агрегат | Нет |
| payment_terminal | Платёжный терминал | Нет |
| dispenser | Дозатор | Да |
| pump | Насос | Нет |
| water_filter | Фильтр воды | Нет |
| coin_acceptor | Монетоприёмник | Нет |
| bill_acceptor | Купюроприёмник | Нет |
| display | Дисплей | Нет |
| other | Прочее | - |

---

## Права доступа

| Операция | Роли |
|----------|------|
| Просмотр | Все авторизованные |
| Создание/редактирование | Admin, Manager, SuperAdmin, Technician |
| Удаление | Admin, SuperAdmin |
| Перемещение/установка | Admin, Manager, SuperAdmin, Technician |

---

## Интеграции

- **Machines** - компоненты привязаны к аппаратам
- **Tasks** - задачи на обслуживание/мойку
- **Users** - исполнители работ
- **Notifications** - уведомления об обслуживании

---

## Requirements

| REQ ID | Описание |
|--------|----------|
| REQ-ASSET-01 | Учёт компонентов оборудования |
| REQ-ASSET-02 | Типы компонентов (13 типов) |
| REQ-ASSET-10 | Контроль сроков обслуживания |
| REQ-ASSET-11 | История перемещений |
| REQ-ASSET-20 | Графики мойки |
| REQ-ASSET-21 | Автосоздание задач мойки |
| REQ-ASSET-30 | Учёт затрат на обслуживание |
| REQ-ASSET-BH-01 | Справочник типов бункеров |
| REQ-ASSET-SP-01 | Каталог запчастей |
