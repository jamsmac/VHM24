#!/bin/sh

# VendHub Commit Message Hook
# Validates commit message follows Conventional Commits format

commit_msg_file=$1
commit_msg=$(cat "$commit_msg_file")

# Conventional Commits pattern
# Type: feat, fix, docs, style, refactor, test, chore, perf, ci, build, revert
pattern="^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: .{1,}"

# Also allow merge commits and revert commits
merge_pattern="^Merge "
revert_pattern="^Revert "

if echo "$commit_msg" | grep -qE "$pattern"; then
  exit 0
fi

if echo "$commit_msg" | grep -qE "$merge_pattern"; then
  exit 0
fi

if echo "$commit_msg" | grep -qE "$revert_pattern"; then
  exit 0
fi

echo "ERROR: Invalid commit message format."
echo ""
echo "Your commit message:"
echo "  $commit_msg"
echo ""
echo "Commit message must follow Conventional Commits format:"
echo "  <type>(<scope>): <subject>"
echo ""
echo "Types: feat, fix, docs, style, refactor, test, chore, perf, ci, build, revert"
echo ""
echo "Examples:"
echo "  feat(tasks): add photo validation for task completion"
echo "  fix(auth): resolve token refresh issue"
echo "  docs(readme): update installation instructions"
echo ""
exit 1
