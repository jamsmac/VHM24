# VendHub Manager Telegram Bot

Telegram бот для операторов вендинговых автоматов.

## Технологии

- **Telegraf** - фреймворк для Telegram ботов
- **TypeScript** - типизация
- **Redis** - хранение сессий
- **Axios** - взаимодействие с API

## Функционал

### Для операторов:
- Получение уведомлений о новых задачах
- Просмотр списка задач
- Выполнение задач (пополнение, инкассация, ТО)
- Загрузка фото ДО/ПОСЛЕ выполнения
- Ввод количества товара/денег
- Отчеты о выполненных задачах

### Команды:
- `/start` - Начало работы
- `/tasks` - Мои задачи
- `/help` - Помощь

## Быстрый старт

### Локальная разработка

```bash
# Установка зависимостей
npm install

# Запуск в dev режиме
npm run dev
```

### С Docker

```bash
# Из корня проекта
docker-compose up telegram-bot
```

## Переменные окружения

Создайте `.env` файл:

```env
TELEGRAM_BOT_TOKEN=your_bot_token_from_@BotFather
API_URL=http://localhost:3000
REDIS_HOST=redis
REDIS_PORT=6379
```

## Получение токена бота

1. Найдите @BotFather в Telegram
2. Отправьте `/newbot`
3. Следуйте инструкциям
4. Получите токен
5. Добавьте токен в `.env`

## Структура проекта

```
telegram-bot/
├── src/
│   ├── index.ts           # Точка входа
│   ├── bot.ts             # Настройка бота
│   ├── handlers/          # Обработчики команд
│   │   ├── start.ts
│   │   ├── tasks.ts
│   │   └── photo.ts
│   ├── services/          # Сервисы
│   │   ├── api.service.ts # Взаимодействие с API
│   │   └── redis.service.ts
│   └── utils/             # Утилиты
└── dist/                  # Скомпилированный код
```

## Команды

```bash
npm run dev            # Запуск в dev режиме
npm run build         # Сборка
npm run start         # Запуск production
```

## Workflow выполнения задачи

1. Оператору приходит уведомление о новой задаче
2. Оператор открывает задачу командой `/tasks`
3. Бот показывает детали задачи
4. Оператор нажимает "Начать выполнение"
5. Бот запрашивает фото ДО
6. Оператор загружает фото
7. Оператор выполняет работу
8. Бот запрашивает фото ПОСЛЕ
9. Бот запрашивает количества (товар/деньги)
10. Задача закрывается автоматически
